# Surge Rule Set for Meta AI
# NAME: Meta AI
# AUTHOR: linchao10058
# REPO: https://raw.githubusercontent.com/linchao10058/Surge/main/Rule/meta_ai.list
# UPDATED: 2025-06-06 18:00 PDT
# TOTAL: 28 rules
# DESCRIPTION: Surge rules for routing Meta AI traffic (meta.ai, ai.meta.com, and related AI research domains) through PROXY. Explicitly excludes other Meta services (e.g., Facebook, Instagram, WhatsApp). Compatible with Surge 5+.

[Rule]
# ---------------------------------------------
# 0. Dynamic Update Sources (must be first!)
# ---------------------------------------------
RULE-SET,https://raw.githubusercontent.com/linchao10058/Surge/main/Rule/meta_ai_dynamic.list,PROXY
RULE-SET,https://raw.githubusercontent.com/linchao10058/Surge/main/Rule/meta_non_ai_dynamic.list,DIRECT

# ---------------------------------------------
# 1. Meta AI Core Domains (High Priority)
# ---------------------------------------------
DOMAIN-SUFFIX,meta.ai,PROXY
DOMAIN-SUFFIX,ai.meta.com,PROXY
DOMAIN,llama3.ai.meta.com,PROXY
DOMAIN,llama.meta.com,PROXY
DOMAIN,imagine.meta.com,PROXY
DOMAIN-KEYWORD,meta-ai-,PROXY
DOMAIN-SUFFIX,botorch.org,PROXY
DOMAIN-SUFFIX,buck.build,PROXY
DOMAIN-SUFFIX,fasttext.cc,PROXY
DOMAIN-SUFFIX,fbinfer.com,PROXY
DOMAIN-SUFFIX,flow.dev,PROXY
DOMAIN-SUFFIX,pyrobot.org,PROXY
DOMAIN-SUFFIX,rocksdb.org,PROXY
DOMAIN-SUFFIX,faiss.ai,PROXY
DOMAIN-SUFFIX,habitat.fair,PROXY
DOMAIN-SUFFIX,parlai.org,PROXY
DOMAIN-SUFFIX,fairscale.org,PROXY

# ---------------------------------------------
# 2. Other Meta Services (Non-AI, routed to DIRECT)
# ---------------------------------------------
DOMAIN-SUFFIX,facebook.com,DIRECT
DOMAIN-SUFFIX,fb.com,DIRECT
DOMAIN-SUFFIX,instagram.com,DIRECT
DOMAIN-SUFFIX,whatsapp.com,DIRECT
DOMAIN-SUFFIX,oculus.com,DIRECT
DOMAIN-SUFFIX,messenger.com,DIRECT
DOMAIN-SUFFIX,fb.me,DIRECT
DOMAIN-SUFFIX,careersatfb.com,DIRECT
DOMAIN-SUFFIX,crowdtangle.com,DIRECT
DOMAIN-SUFFIX,facebook.net,DIRECT
DOMAIN-SUFFIX,facebookbrand.com,DIRECT
DOMAIN-SUFFIX,fbcdn.net,DIRECT
DOMAIN-SUFFIX,igcdn.com,DIRECT
DOMAIN-SUFFIX,igtv.com,DIRECT
DOMAIN-SUFFIX,instagram-brand.com,DIRECT
DOMAIN-SUFFIX,oculuscdn.com,DIRECT
DOMAIN-SUFFIX,reactjs.org,DIRECT
DOMAIN-SUFFIX,whatsapp.biz,DIRECT
DOMAIN-SUFFIX,whatsapp.org,DIRECT
DOMAIN-SUFFIX,yogalayout.com,DIRECT

# ---------------------------------------------
# 3. Meta AI IP Ranges (Verified AI/CDN subnets)
# ---------------------------------------------
IP-CIDR,157.240.241.0/24,PROXY
IP-CIDR,31.13.85.0/24,PROXY
IP-CIDR,185.89.216.0/22,PROXY
IP-CIDR,129.134.0.0/16,PROXY

# ---------------------------------------------
# 4. Meta Non-AI IP Ranges (Routed to DIRECT)
# ---------------------------------------------
IP-CIDR,69.171.224.0/19,DIRECT
IP-CIDR,108.168.176.192/26,DIRECT
IP-CIDR,108.168.177.0/27,DIRECT
IP-CIDR,108.168.180.96/27,DIRECT

# ---------------------------------------------
# 5. Local Network Exclusion (Performance)
# ---------------------------------------------
IP-CIDR,192.168.0.0/16,DIRECT
IP-CIDR,10.0.0.0/8,DIRECT
IP-CIDR,172.16.0.0/12,DIRECT
IP-CIDR,100.64.0.0/10,DIRECT
IP-CIDR,169.254.0.0/16,DIRECT

# ---------------------------------------------
# 6. Final Catch-All Rule
# ---------------------------------------------
FINAL,DIRECT

[Script]
meta_ai_header_inject = type=http-request, pattern=^https:\/\/([a-zA-Z0-9-]+\.)*(meta\.ai|ai\.meta\.com), script-path=https://raw.githubusercontent.com/linchao10058/Surge/main/Script/meta_ai_headers.js, requires-body=false, timeout=10

[General]
loglevel = notify
dns-server = system, 8.8.8.8
resource-update-interval = 86400